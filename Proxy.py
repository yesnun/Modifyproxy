#!/usr/bin/python
# -*- coding: UTF-8 -*-
import re, _winreg, time

proxy_configuration = 'F\x00\x00\x00\x83\x02\x00\x00\x05\x00\x00\x00\x10\x00\x00\x0010.144.1.10:8080\x07\x00\x00\x00<local>\x12\x00\x00\x00D:\\proxy\\proxy.pac\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x02\x00\x00\x00\n\x8d}P\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'

def openregistry_Modifyvalue():
    key = _winreg.OpenKey(
                  _winreg.HKEY_CURRENT_USER,
                 'Software\Microsoft\Windows\CurrentVersion\
                  Internet  Settings\Connections',0,
                  _winreg.KEY_ALL_ACCESS)
    content = _winreg.QueryValueEx(key, 'DefaultConnectionSettings')
    string_content = str(content)
    m = re.search("http://proxyconf", string_content[1:200])
    if(m):
        _winreg.SetValueEx(key, 'DefaultConnectionSettings', 0,
                     _winreg.REG_BINARY, proxy_configuration) 
        print time.ctime()
        print "Success"
    else:
        print "failed"

    _winreg.CloseKey(key)

def Read_Local():
    f = open('D:\Hi.txt','wb')
    f.write(string_content)
    f.close()

if __name__=="__main__":
    while 1:
            openregistry_Modifyvalue()
            time.sleep(60)